

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Dockerized QPKG &mdash; Container Station  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Container Station  documentation" href="index.html"/>
        <link rel="next" title="Change Log" href="changelog.html"/>
        <link rel="prev" title="Qnet" href="qnet.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Container Station
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="system.html">System</a></li>
<li class="toctree-l1"><a class="reference internal" href="container.html">Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="background.html">Background tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="application.html">Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="resource.html">Resource</a></li>
<li class="toctree-l1"><a class="reference internal" href="image.html">Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="networks.html">Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="volumes.html">Volumes</a></li>
<li class="toctree-l1"><a class="reference internal" href="log.html">Log and Event</a></li>
<li class="toctree-l1"><a class="reference internal" href="preference.html">Preference</a></li>
<li class="toctree-l1"><a class="reference internal" href="qnet.html">Qnet</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Dockerized QPKG</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-dockerized-qpkg-dqpkg">What is Dockerized QPKG (DQPKG)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#quick-start">Quick Start</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#get-docker">Get Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-git">Install Git</a></li>
<li class="toctree-l3"><a class="reference internal" href="#download-sample-code">Download Sample Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-nginx-qpkg">Build Nginx QPKG</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#build-your-own-dockerized-qpkg">Build Your Own Dockerized QPKG</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configure-qpkg">Configure QPKG</a></li>
<li class="toctree-l3"><a class="reference internal" href="#customize-qpkg-routines">Customize QPKG routines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#add-files-to-qpkg">Add files to QPKG</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-files-under-shared">Other files under shared/</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#example-gitlab">Example: GitLab</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#define-the-project-components">Define the project components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-gitlab-qpkg">Create a GitLab QPKG</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-gitlab-on-nas">Install GitLab on NAS</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Container Station</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Dockerized QPKG</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/dqpkg.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="dockerized-qpkg">
<h1><a class="toc-backref" href="#id2">Dockerized QPKG</a><a class="headerlink" href="#dockerized-qpkg" title="Permalink to this headline">¶</a></h1>
<p></p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#dockerized-qpkg" id="id2">Dockerized QPKG</a><ul>
<li><a class="reference internal" href="#what-is-dockerized-qpkg-dqpkg" id="id3">What is Dockerized QPKG (DQPKG)</a></li>
<li><a class="reference internal" href="#quick-start" id="id4">Quick Start</a><ul>
<li><a class="reference internal" href="#get-docker" id="id5">Get Docker</a></li>
<li><a class="reference internal" href="#install-git" id="id6">Install Git</a></li>
<li><a class="reference internal" href="#download-sample-code" id="id7">Download Sample Code</a></li>
<li><a class="reference internal" href="#build-nginx-qpkg" id="id8">Build Nginx QPKG</a></li>
</ul>
</li>
<li><a class="reference internal" href="#build-your-own-dockerized-qpkg" id="id9">Build Your Own Dockerized QPKG</a><ul>
<li><a class="reference internal" href="#configure-qpkg" id="id10">Configure QPKG</a></li>
<li><a class="reference internal" href="#customize-qpkg-routines" id="id11">Customize QPKG routines</a></li>
<li><a class="reference internal" href="#add-files-to-qpkg" id="id12">Add files to QPKG</a></li>
<li><a class="reference internal" href="#other-files-under-shared" id="id13">Other files under shared/</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-gitlab" id="id14">Example: GitLab</a><ul>
<li><a class="reference internal" href="#define-the-project-components" id="id15">Define the project components</a></li>
<li><a class="reference internal" href="#create-a-gitlab-qpkg" id="id16">Create a GitLab QPKG</a></li>
<li><a class="reference internal" href="#install-gitlab-on-nas" id="id17">Install GitLab on NAS</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="what-is-dockerized-qpkg-dqpkg">
<h2><a class="toc-backref" href="#id3">What is Dockerized QPKG (DQPKG)</a><a class="headerlink" href="#what-is-dockerized-qpkg-dqpkg" title="Permalink to this headline">¶</a></h2>
<p>Dockerized QPKG is a QPKG that simply ship Docker Application into QNAP NAS. DQPKG comprises a <a class="reference external" href="https://docs.docker.com/compose/overview/">Docker-Compose</a> file to describe application&#8217;s services, a setup wizard to configure Docker-Compose file before launching and a reverse proxy configure file to serve application with the same port as NAS.</p>
</div>
<div class="section" id="quick-start">
<h2><a class="toc-backref" href="#id4">Quick Start</a><a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h2>
<p>A DQPKG is built by Docker Image (<a class="reference external" href="https://hub.docker.com/r/qnapnas/qdk2/">qnapnas/qdk2</a>). Before starting to build DQPKG, you have to install Docker and Git on your Linux. Following demonstration is supposed to run under Ubuntu 16.04.</p>
<div class="section" id="get-docker">
<h3><a class="toc-backref" href="#id5">Get Docker</a><a class="headerlink" href="#get-docker" title="Permalink to this headline">¶</a></h3>
<p>Update your APT package index including Docker.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>$ sudo apt-get update
$ sudo apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D
$ <span class="nb">echo</span> <span class="s2">&quot;deb https://apt.dockerproject.org/repo ubuntu-xenial main&quot;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/docker.list
$ sudo apt-get update
</pre></div>
</div>
</div></blockquote>
<p>Install Docker.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>$ sudo apt-get install -y docker-engine
</pre></div>
</div>
</div></blockquote>
<p>Verify your installation.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>$ sudo docker run hello-world
</pre></div>
</div>
</div></blockquote>
<p>Full install instructions for all flavors of Linux we support are at <a class="reference external" href="https://docs.docker.com/engine/installation/">Install Docker Engine</a>.</p>
</div>
<div class="section" id="install-git">
<h3><a class="toc-backref" href="#id6">Install Git</a><a class="headerlink" href="#install-git" title="Permalink to this headline">¶</a></h3>
<p>It is easiest to install Git on Linux using the preferred package manager of your Linux distribution.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>$ sudo apt-get install git
</pre></div>
</div>
</div></blockquote>
<p>For other Linux distribution, please refer to <a class="reference external" href="https://git-scm.com/download/linux">Download for Linux and Unix</a>.</p>
</div>
<div class="section" id="download-sample-code">
<h3><a class="toc-backref" href="#id7">Download Sample Code</a><a class="headerlink" href="#download-sample-code" title="Permalink to this headline">¶</a></h3>
<p>Docker-QDK2 is a tool for building multi-container Docker applications, and there are many example including in this repository.</p>
<p>Download Docker-QDK2 into your system.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>$ git clone https://github.com/qnap-dev/docker-qdk2.git
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="build-nginx-qpkg">
<h3><a class="toc-backref" href="#id8">Build Nginx QPKG</a><a class="headerlink" href="#build-nginx-qpkg" title="Permalink to this headline">¶</a></h3>
<p>Change directory to docker-qdk2 and build Nginx QPKG.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> docker-qdk2
$ sudo docker run -it --rm -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>/example/nginx:/src walkerlee/qdk2-build
</pre></div>
</div>
</div></blockquote>
<p>Nginx QPKG file will be generated in the nginx folder.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>$ ls example/nginx/nginx_1.11.qpkg
example/nginx/nginx_1.11.qpkg
</pre></div>
</div>
</div></blockquote>
<p>You now can install your QPKG(or download here) in “App Center” → “Manual Install” of QNAP NAS.</p>
</div>
</div>
<div class="section" id="build-your-own-dockerized-qpkg">
<h2><a class="toc-backref" href="#id9">Build Your Own Dockerized QPKG</a><a class="headerlink" href="#build-your-own-dockerized-qpkg" title="Permalink to this headline">¶</a></h2>
<p>In this section, we will explain Nginx QPKG in depth. The source code can be found in <a class="reference external" href="https://github.com/qnap-dev/docker-qdk2/tree/master/example/nginx">nginx folder</a> in Docker-QDK2. “example/nginx” is the context for your application as shown in following. The directory should only contain resources to start that app.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>example/nginx
├──build/
│   └── nginx_1.11_x86_64.qpkg
├── icons/
├── package_routines
├── qpkg.cfg
└── shared/
    ├── docker-compose.yml
    ├── nginx.apache.conf.tpl
    ├── nginx.sh
    └── wizard/
        ├── description/
        │   ├── cht.md
        │   └── eng.md
        ├── i18n/
        │   ├── cht.json
        │   └── eng.json
        └── install.json
</pre></div>
</div>
</div></blockquote>
<div class="section" id="configure-qpkg">
<h3><a class="toc-backref" href="#id10">Configure QPKG</a><a class="headerlink" href="#configure-qpkg" title="Permalink to this headline">¶</a></h3>
<p>Edit the content of &#8220;qpkg.cfg&#8221;</p>
<blockquote>
<div><ul class="simple">
<li>QPKG_NAME: Name of the QPKG, which is usually composed in lowercase and hyphen(-)</li>
<li>QPKG_VER: Version of the QPKG, which is limited to 12 characters and formed by digital and dot(.)</li>
<li>QPKG_AUTHOR: Author of the QPKG</li>
</ul>
</div></blockquote>
<p>Example of nginx/qpkg.cfg:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">QPKG_NAME</span><span class="o">=</span><span class="s2">&quot;nginx&quot;</span>
<span class="nv">QPKG_DISPLAYNAME</span><span class="o">=</span><span class="s2">&quot;Nginx&quot;</span>
<span class="nv">QPKG_VER</span><span class="o">=</span><span class="s2">&quot;1.11&quot;</span>
<span class="nv">QPKG_AUTHOR</span><span class="o">=</span><span class="s2">&quot;container@qnap.com&quot;</span>
<span class="nv">QPKG_SUMMARY</span><span class="o">=</span><span class="s2">&quot;Nginx (pronounced &quot;</span>engine-x<span class="s2">&quot;) is an open source reverse proxy server for HTTP, HTTPS, SMTP, POP3, and IMAP protocols, as well as a load balancer, HTTP cache, and a web server (origin server).&quot;</span>
<span class="nv">QPKG_SERVICE_PROGRAM</span><span class="o">=</span><span class="s2">&quot;nginx.sh&quot;</span>
<span class="nv">QPKG_TIMEOUT</span><span class="o">=</span><span class="s2">&quot;120,60&quot;</span>
<span class="nv">QPKG_REQUIRE</span><span class="o">=</span><span class="s2">&quot;container-station &gt;= 1.7.1893&quot;</span>
<span class="nv">QPKG_WEBUI</span><span class="o">=</span><span class="s2">&quot;/nginx/&quot;</span>
<span class="nv">QPKG_WEB_PORT</span><span class="o">=</span><span class="s2">&quot;-1&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p>Please refer to <a class="reference external" href="http://download.qnap.com/dev/QDK_2.0.pdf">QDK - QPKG Development Kit</a> for detail.</p>
</div>
<div class="section" id="customize-qpkg-routines">
<h3><a class="toc-backref" href="#id11">Customize QPKG routines</a><a class="headerlink" href="#customize-qpkg-routines" title="Permalink to this headline">¶</a></h3>
<p>Content of file “package_routines”</p>
<blockquote>
<div><ul class="simple">
<li>pkg_pre_install() : routines before install</li>
<li>pkg_install() : routines during install</li>
<li>pkg_post_install() : routines after install</li>
<li>PKG_PRE_REMOVE : routines before uninstall</li>
<li>PKG_MAIN_REMOVE : routines during uninstall</li>
<li>PKG_POST_REMOVE : routines after uninstall</li>
</ul>
</div></blockquote>
<p>Content of file “shared/nginx.sh&#8221;</p>
<blockquote>
<div><ul class="simple">
<li>Start : routines when starting the QPKG</li>
<li>Stop : routines when stopping the QPKG</li>
<li>Remove : routines when removing the QPKG</li>
</ul>
</div></blockquote>
<p>Take Nginx for example, when Nginx APP launch, nginx.sh call dqpkg service to pull image correctly and start Nginx service.</p>
<blockquote>
<div><ul class="simple">
<li>Start - qbus put com.qnap.dqpkg/qpkg/nginx/start</li>
<li>Stop - qbus put com.qnap.dqpkg/qpkg/nginx/stop</li>
<li>Remove - qbus put com.qnap.dqpkg/qpkg/nginx/remove</li>
</ul>
</div></blockquote>
<p>Please refer to <a class="reference external" href="http://download.qnap.com/dev/QDK_2.0.pdf">QDK - QPKG Development Kit</a> for detail.</p>
</div>
<div class="section" id="add-files-to-qpkg">
<h3><a class="toc-backref" href="#id12">Add files to QPKG</a><a class="headerlink" href="#add-files-to-qpkg" title="Permalink to this headline">¶</a></h3>
<p>Put files in below folders for different purposes:</p>
<blockquote>
<div><ul>
<li><p class="first">shared/: Platform-independent files and folders. Details in the next section.</p>
</li>
<li><p class="first">icons/: icon files</p>
<blockquote>
<div><ul class="simple">
<li>${QPKG_NAME}.gif is the image displayed in the web interface when the QPKG is enabled. It should be a GIF image of 64x64 pixels.</li>
<li>${QPKG_NAME}_gray.gif is the image displayed in the web interface when the QPKG is disabled. It should be a GIF image of 64x64 pixels. It is usually a grayscale version of the ${QPKG_NAME}.gif image, but that is not a requirement.</li>
<li>${QPKG_NAME}_80.gif is the image displayed in the pop-up dialog (with information about the QPKG and the buttons to enable, disable, and remove). It should be a GIF image of 80x80 pixels.</li>
<li>If no icons are included then the QPKG is given default icons at installation.</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="other-files-under-shared">
<h3><a class="toc-backref" href="#id13">Other files under shared/</a><a class="headerlink" href="#other-files-under-shared" title="Permalink to this headline">¶</a></h3>
<p><strong>QPKG Description</strong></p>
<p>We begin with a description file of the QPKG in Markdown syntax. Description file naming with language code in lowercase. (i.e., eng.md, cht.md)</p>
<p>Example of description file wizard/eng.md:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1">## Description</span>
Nginx <span class="o">(</span>pronounced <span class="s2">&quot;engine-x&quot;</span><span class="o">)</span> is an open <span class="nb">source</span> reverse proxy server <span class="k">for</span> HTTP, HTTPS, SMTP, POP3, and IMAP protocols, as well as a load balancer, HTTP cache, and a web server <span class="o">(</span>origin server<span class="o">)</span>.
</pre></div>
</div>
</div></blockquote>
<p>Language code list:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="59%" />
<col width="12%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Languages</th>
<th class="head">Languages in Chinese</th>
<th class="head">Code</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>English</td>
<td>英文</td>
<td>ENG</td>
</tr>
<tr class="row-odd"><td>简体中文</td>
<td>简体中文</td>
<td>CHS</td>
</tr>
<tr class="row-even"><td>繁體中文</td>
<td>繁體中文</td>
<td>CHT</td>
</tr>
<tr class="row-odd"><td>Czech</td>
<td>捷克語</td>
<td>CZE</td>
</tr>
<tr class="row-even"><td>Dansk</td>
<td>丹麥語</td>
<td>DAN</td>
</tr>
<tr class="row-odd"><td>Deutsch</td>
<td>德語</td>
<td>GER</td>
</tr>
<tr class="row-even"><td>Español</td>
<td>西班牙語</td>
<td>SPA</td>
</tr>
<tr class="row-odd"><td>Français</td>
<td>法國語</td>
<td>FRE</td>
</tr>
<tr class="row-even"><td>Italiano</td>
<td>意大利語</td>
<td>ITA</td>
</tr>
<tr class="row-odd"><td>日本語</td>
<td>日本語</td>
<td>JPN</td>
</tr>
<tr class="row-even"><td>한글</td>
<td>韓語</td>
<td>KOR</td>
</tr>
<tr class="row-odd"><td>Norsk</td>
<td>挪威語</td>
<td>NOR</td>
</tr>
<tr class="row-even"><td>Polski</td>
<td>波蘭語</td>
<td>POL</td>
</tr>
<tr class="row-odd"><td>Русский</td>
<td>俄羅斯語</td>
<td>RUS</td>
</tr>
<tr class="row-even"><td>Suomi</td>
<td>芬蘭語</td>
<td>FIN</td>
</tr>
<tr class="row-odd"><td>Svenska</td>
<td>瑞典語</td>
<td>SWE</td>
</tr>
<tr class="row-even"><td>Nederlands</td>
<td>荷蘭語</td>
<td>DUT</td>
</tr>
<tr class="row-odd"><td>Turk dili</td>
<td>土耳其語</td>
<td>TUR</td>
</tr>
<tr class="row-even"><td>ไทย</td>
<td>泰國語</td>
<td>THA</td>
</tr>
<tr class="row-odd"><td>Português</td>
<td>葡萄牙語</td>
<td>POR</td>
</tr>
<tr class="row-even"><td>Magyar</td>
<td>匈牙利語</td>
<td>HUN</td>
</tr>
<tr class="row-odd"><td>Ελληνικά</td>
<td>希臘語</td>
<td>GRK</td>
</tr>
<tr class="row-even"><td>Român</td>
<td>羅馬尼亞語</td>
<td>ROM</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><strong>Compose file</strong></p>
<p>Compose is a tool for defining and running multi-container Docker applications. With Compose, you use a Compose file to configure your application’s services.
Three points for attention in writing docker-compose.yml file.</p>
<ul class="simple">
<li>Dockerized QPKG only supported version 2 file format.</li>
<li>The service need to expose port 80 in port configuration (“HOST_PORT:CONTAINER_PORT”). In other words, CONTAINER_PORT must be set to 80 because the system will check service health by connecting to port 80.</li>
<li>To avoid losing any data when upgrading the service, you should mount a volume at ${PWD}</li>
</ul>
<p>Example of shared/docker-compose.yml:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>version: <span class="s1">&#39;2&#39;</span>

services:
  nginx:
    image: nginx:1.11-alpine
    ports:
      - <span class="s2">&quot;18080:80&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p>Full reference: <a class="reference external" href="https://docs.docker.com/compose/compose-file/">https://docs.docker.com/compose/compose-file/</a></p>
<p><strong>Apache reverse proxy</strong></p>
<p>In order to let your APP provide service on port 8080 (It’s the same with default HTTP port of NAS), we can create a ${QPKG_NAME}.apache.conf.tpl to configure NAS reverse proxy.</p>
<p>Example of shared/nginx.apache.conf.tpl:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>ProxyRequests off
ProxyPass /nginx http://127.0.0.1:&lt;@http_port@&gt;
ProxyPassReverse /nginx http://127.0.0.1:&lt;@http_port@&gt;
</pre></div>
</div>
</div></blockquote>
<p>For further information, please refer to <a class="reference external" href="https://httpd.apache.org/docs/current/mod/mod_proxy.html">Apache Module mod_proxy</a>.</p>
<p><strong>Setup wizard</strong></p>
<p>reate a config file install.json describing how it will be integrated into QTS in JSON format, and stored in the <strong>wizard</strong> folder.</p>
<p>It contains three things under wizard directory.</p>
<blockquote>
<div><ol class="arabic simple">
<li><strong>description/</strong> - Short description of your APP.</li>
<li><strong>i18n/</strong> - Internationalization (i18n) is the process of developing products in such a way that they can be localized for languages and cultures easily. We provide English and Chinese (Traditional) file under i18n folder.You can define environment variables in eng.json and cht.json. Based on the language of NAS, the system will set proper parameters into install.json.</li>
<li><strong>install.json</strong> - This file is used to define wizard and form for custom configuration. According to user requirements, wizard can provide pages for setting different kinds of environment variables before the service installing. After user fills out forms, parameters will be saved to docker-compose-wizard.yml. At last, Compose run services from docker-compose-wizard.yml. These wizard pages are generated from install.json. You need to modify install.json for custom configuration.</li>
</ol>
</div></blockquote>
<p>Example of shared/wizard/install.json:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">{</span>
  <span class="s2">&quot;api_version&quot;</span>: <span class="s2">&quot;v1&quot;</span>,
  <span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;{{NGINX_NAME}}&quot;</span>,
  <span class="s2">&quot;wizard&quot;</span>: <span class="o">[</span>
    <span class="o">{</span>
      <span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;{{NGINX_BASE_PAGE}}&quot;</span>,
      <span class="s2">&quot;schema&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;http_port&quot;</span>: <span class="o">{</span>
          <span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;HTTP Port&quot;</span>,
          <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;integer&quot;</span>,
          <span class="s2">&quot;description&quot;</span>: <span class="s2">&quot;{{NGINX_WEB_HOST_PORT_DESC}}&quot;</span>,
          <span class="s2">&quot;minimum&quot;</span>: <span class="m">1</span>,
          <span class="s2">&quot;maximum&quot;</span>: <span class="m">65535</span>,
          <span class="s2">&quot;required&quot;</span>: <span class="nb">true</span>
        <span class="o">}</span>
      <span class="o">}</span>,
      <span class="s2">&quot;form&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;http_port&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>
  <span class="o">]</span>,
  <span class="s2">&quot;binding&quot;</span>: <span class="o">{</span>
    <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;yaml&quot;</span>,
    <span class="s2">&quot;file&quot;</span>: <span class="s2">&quot;docker-compose.yml&quot;</span>,
    <span class="s2">&quot;data&quot;</span>: <span class="o">{</span>
      <span class="s2">&quot;http_port&quot;</span>: <span class="s2">&quot;services.nginx.ports[0]&quot;</span>
    <span class="o">}</span>,
    <span class="s2">&quot;template&quot;</span>: <span class="o">[</span><span class="s2">&quot;\*.tpl&quot;</span><span class="o">]</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<ul>
<li><p class="first">api_version - The latest version is v1.</p>
</li>
<li><p class="first">title - Define a title for your pop-up wizard page.</p>
</li>
<li><p class="first">wizard - The wizard maps to an array. It’s composed of three parts:</p>
<blockquote>
<div><ul>
<li><p class="first">title - Subtitle of pop-up wizard page.</p>
</li>
<li><p class="first">schema - A unique component key value represents a UI component.</p>
<blockquote>
<div><ul class="simple">
<li>title - The title of the field</li>
<li>type - The type of the value</li>
<li>description - The description of the field</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">form - Objects defined in schema.</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Binding - Binding a file with install.json.</p>
<blockquote>
<div><ul class="simple">
<li>type - The type of wizard file is YAML. Only support YAML type currently.</li>
<li>file - Only support docker-compose.yml currently.</li>
<li>data - Get default value from the binding file</li>
<li>template - Set values to specific file. Take Nginx for example, the value of http_port maps to &lt;&#64;http_port&#64;&gt; in shared/nginx.apache.conf.tpl.</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>Here are the details of <strong>install.json</strong> content in JSON format:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>api_version</td>
<td>Currently we have only “v1” supported</td>
</tr>
<tr class="row-odd"><td>title</td>
<td>Application name</td>
</tr>
<tr class="row-even"><td>wizard</td>
<td>Combine with JSON schema and form definition</td>
</tr>
<tr class="row-odd"><td>binding</td>
<td>Express your binding rules. It can override values in file depends on user’s input</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Here are the properties of <strong>wizard</strong>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="94%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Key</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>title</td>
<td>Title of the field</td>
</tr>
<tr class="row-odd"><td>schema</td>
<td><p class="first">Schema for this field.</p>
<ul class="simple">
<li>“<strong>title</strong>”: A title will preferably be short</li>
<li>“<strong>type</strong>”: Must be &#8220;string&#8221;, &#8220;integer&#8221;, &#8220;boolean&#8221;</li>
<li>“<strong>description</strong>”: description will provide explanation about the purpose of the instance described by this schema.</li>
</ul>
<p>Other validataion keywords:</p>
<p class="last"><a class="reference external" href="http://json-schema.org/latest/json-schema-validation.html#anchor12">http://json-schema.org/latest/json-schema-validation.html#anchor12</a></p>
</td>
</tr>
<tr class="row-even"><td>form</td>
<td>If you need to override the order of the forms, or just want to be sure, specify a form definition.</td>
</tr>
</tbody>
</table>
<p>General options most field types can handle in the <strong>form</strong>:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="78%" />
<col width="6%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Key</th>
<th class="head">Description</th>
<th class="head">Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>key</td>
<td>The dot notation to the attribute on the schema</td>
<td>String</td>
</tr>
<tr class="row-odd"><td>type</td>
<td>Type of field</td>
<td>String</td>
</tr>
<tr class="row-even"><td>title</td>
<td>Title of field, taken from schema if available</td>
<td>String</td>
</tr>
<tr class="row-odd"><td>notitle</td>
<td>Set to true to hide title</td>
<td>Boolean</td>
</tr>
<tr class="row-even"><td>description</td>
<td>A description, taken from schema if available, can be HTML</td>
<td>String</td>
</tr>
<tr class="row-odd"><td>validationMessage</td>
<td>Custom validation error message</td>
<td>String</td>
</tr>
<tr class="row-even"><td>disableSuccessState</td>
<td>Set true to NOT apply &#8216;has-success&#8217; class to a field that was validated successfully</td>
<td>Boolean</td>
</tr>
<tr class="row-odd"><td>disableErrorState</td>
<td>Set true to NOT apply &#8216;has-error&#8217; class to a field that failed validation</td>
<td>Boolean</td>
</tr>
<tr class="row-even"><td>readonly</td>
<td>Same effect as readOnly in schema. Put on a fieldset or array and their items will inherit it.</td>
<td>Boolean</td>
</tr>
<tr class="row-odd"><td>htmlClass</td>
<td>CSS Class(es) to be added to the container div</td>
<td>String</td>
</tr>
<tr class="row-even"><td>fieldHtmlClass</td>
<td>CSS Class(es) to be added to field input (or similar)</td>
<td>String</td>
</tr>
<tr class="row-odd"><td>labelHtmlClass</td>
<td>CSS Class(es) to be added to the label of the field (or similar)</td>
<td>String</td>
</tr>
<tr class="row-even"><td>condition</td>
<td>Show or hide field depending on expression</td>
<td>String</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Here are the properties of <strong>binding</strong>:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="93%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Key</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>type</td>
<td>Support for &#8220;yaml” only</td>
</tr>
<tr class="row-odd"><td>file</td>
<td>Support for “docker-compose.yml” only</td>
</tr>
<tr class="row-even"><td>data</td>
<td>The key-value pairs inside data will override the value in docker-compose.yml</td>
</tr>
<tr class="row-odd"><td>template</td>
<td><p class="first">It will default to rendering all files under QPKG directory which match your conditions.</p>
<p class="last">Example in Nginx is “*tpl”. It would rendering file “nginx.apache.conf.tpl” to “nginx.apache.conf”</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>All words are case sensitive.</li>
<li>The {{ANY_STRING}} expression is defined in translation files under i18n folder.</li>
</ul>
</div>
<p><strong>Generate QPKG file</strong></p>
<p>When everything is done, pack QPKG by Docker-QDK2 into nginx.qpkg.</p>
<ul>
<li><p class="first">Use below command to build the QPKG file</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>$ sudo docker run -it --rm -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>/example/nginx:/src walkerlee/qdk2-build
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">The QPKG file will be generated in the nginx folder</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>$ ls example/nginx/nginx_1.11.qpkg
example/nginx/nginx_1.11.qpkg
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="example-gitlab">
<h2><a class="toc-backref" href="#id14">Example: GitLab</a><a class="headerlink" href="#example-gitlab" title="Permalink to this headline">¶</a></h2>
<p>This section demonstrates how to build GitLab and run a Dockerized QPKG on NAS. The GitLab project is under docker-qdk2/example/gitlab folder.</p>
<p>Download Gitlab QPKG directly:
<a class="reference external" href="https://github.com/qnap-dev/docker-qdk2/raw/master/example/gitlab/build/gitlab_8.16.6_x86_64.qpkg">https://github.com/qnap-dev/docker-qdk2/raw/master/example/gitlab/build/gitlab_8.16.6_x86_64.qpkg</a></p>
<div class="section" id="define-the-project-components">
<h3><a class="toc-backref" href="#id15">Define the project components</a><a class="headerlink" href="#define-the-project-components" title="Permalink to this headline">¶</a></h3>
<p>Referring to the previous section. Make sure all files required for installation are available.</p>
<p>Here is the contents of GitLab directory.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>gitlab
├── build/
│   └── gitlab_8.16.6_x86_64.qpkg
├── icons/
├── package_routines
├── qpkg.cfg
└── shared/
    ├── docker-compose.yml
    ├── gitlab.apache.conf.tpl
    ├── gitlab.sh
    └── wizard/
        ├── description
        │   ├── cht.md
        │   └── eng.md
        ├── i18n/
        │   ├── cht.json
        │   └── eng.json
        └── install.json
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="create-a-gitlab-qpkg">
<h3><a class="toc-backref" href="#id16">Create a GitLab QPKG</a><a class="headerlink" href="#create-a-gitlab-qpkg" title="Permalink to this headline">¶</a></h3>
<p>In this step, you create a GitLab started project by building the QPKG from the build context defined in the previous procedure. Before building the QPKG, you have to add a target of your project in docker-qdk2/example/Makefile.</p>
<p>Run the following command to build the QPKG.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> docker-qdk2
$ sudo docker run -it --rm -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>/example:/src walkerlee/qdk2-build bash -c <span class="s2">&quot;cd /src; make&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p>When procedure completed, the QPKG file would be created in build folder.</p>
</div>
<div class="section" id="install-gitlab-on-nas">
<h3><a class="toc-backref" href="#id17">Install GitLab on NAS</a><a class="headerlink" href="#install-gitlab-on-nas" title="Permalink to this headline">¶</a></h3>
<p>First, Install GitLab in App Center and wait for the installation to complete. When clicking <strong>Open</strong> button of GitLab, the wizard description of GitLab will be shown in a new tab.</p>
<img alt="_images/gitlab_install.png" src="_images/gitlab_install.png" />
<p>In order to run GitLab smoothly, please make sure that your NAS meet all requirements mentioned in <strong>Prerequisites</strong> and <strong>Description</strong>. Then, click <strong>Next</strong> to setup Gitlab.</p>
<img alt="_images/gitlab_wizard1.png" src="_images/gitlab_wizard1.png" />
<p>In this step, configure the port of GItLab server and other information for root user. Then, click <strong>Next</strong> to continue.</p>
<img alt="_images/gitlab_wizard2.png" src="_images/gitlab_wizard2.png" />
<p>Configure GitLab SMTP service.</p>
<img alt="_images/gitlab_wizard3.png" src="_images/gitlab_wizard3.png" />
<p>Configure GitLab LDAP service and click <strong>Finish</strong> button.</p>
<img alt="_images/gitlab_wizard4.png" src="_images/gitlab_wizard4.png" />
<p>Please allow a few minutes for GitLab to initialize. It will redirect to APP’s website at the end of <strong>Installing</strong> and <strong>Starting</strong>. You need to create a password for root for the first time.</p>
<img alt="_images/gitlab_password.png" src="_images/gitlab_password.png" />
<p>In this example, key-in the default username <strong>root</strong> and password you set in previous page. Then, click <strong>Sign in</strong>.</p>
<img alt="_images/gitlab_homepage.png" src="_images/gitlab_homepage.png" />
<p>Finally, It would login to GitLab Dashboard.</p>
<img alt="_images/gitlab_dashboard.png" src="_images/gitlab_dashboard.png" />
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="changelog.html" class="btn btn-neutral float-right" title="Change Log" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="qnet.html" class="btn btn-neutral" title="Qnet" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, QNAP System, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/extension.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>